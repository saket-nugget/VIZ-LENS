
[2026-01-14T07:08:44.520Z] Error: Cannot destructure property 'query' of 'req.body' as it is undefined.
Details: {}

[2026-01-14T07:19:05.753Z] Error: response.text is not a function
Details: {}

[2026-01-14T07:19:09.291Z] Error: response.text is not a function
Details: {}

[DEBUG Response]: {
  "sdkHttpResponse": {
    "headers": {
      "alt-svc": "h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000",
      "content-encoding": "gzip",
      "content-type": "application/json; charset=UTF-8",
      "date": "Wed, 14 Jan 2026 07:22:13 GMT",
      "server": "scaffolding on HTTPServer2",
      "server-timing": "gfet4t7; dur=42481",
      "transfer-encoding": "chunked",
      "vary": "Origin, X-Origin, Referer",
      "x-content-type-options": "nosniff",
      "x-frame-options": "SAMEORIGIN",
      "x-xss-protection": "0"
    }
  },
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>VIZ-LENS: Binary Search</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            margin: 0;\n            padding: 0;\n            background-color: #0f172a; /* Dark slate */\n            color: #e2e8f0; /* Light text */\n            display: flex;\n            flex-direction: column;\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n\n        header {\n            background: rgba(15, 23, 42, 0.8); /* Semi-transparent dark slate */\n            backdrop-filter: blur(10px);\n            padding: 1rem 2rem;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);\n            text-align: center;\n            border-bottom: 1px solid rgba(0, 209, 255, 0.3);\n            z-index: 100;\n        }\n\n        h1 {\n            color: #00d1ff; /* Blue */\n            margin: 0;\n            font-size: 2.2rem;\n            letter-spacing: 1px;\n            text-shadow: 0 0 8px rgba(0, 209, 255, 0.5);\n        }\n\n        .container {\n            flex-grow: 1;\n            display: flex;\n            flex-wrap: wrap;\n            padding: 1.5rem;\n            gap: 1.5rem;\n            justify-content: center;\n            align-items: flex-start; /* Align items to the start of the cross axis */\n        }\n\n        .panel {\n            background: rgba(30, 41, 59, 0.7); /* Darker slate, semi-transparent */\n            backdrop-filter: blur(8px);\n            border: 1px solid rgba(0, 209, 255, 0.2);\n            border-radius: 12px;\n            padding: 1.5rem;\n            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);\n            display: flex;\n            flex-direction: column;\n            min-width: 300px;\n            max-width: 100%;\n        }\n\n        /* Responsive panel sizing */\n        .panel.full-width {\n            flex-basis: 100%;\n        }\n        .panel.half-width {\n            flex-basis: calc(50% - 0.75rem); /* Account for gap */\n            min-width: 400px;\n        }\n        .panel.quarter-width {\n            flex-basis: calc(25% - 1.125rem); /* Account for gap */\n            min-width: 300px;\n        }\n\n        #statsPanel {\n            flex-grow: 0;\n            max-width: 400px;\n            width: 100%;\n        }\n\n        #vizContainer {\n            flex-grow: 1;\n            min-width: 600px;\n            max-width: calc(100% - 400px - 1.5rem); /* Accommodate stats panel */\n            height: 450px; /* Fixed height for canvas container */\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n        }\n        #vizCanvas {\n            width: 100%;\n            height: 100%;\n            border-radius: 8px;\n            background-color: #1e293b; /* Slightly lighter dark slate for canvas bg */\n        }\n\n        #controlsPanel, #inputLab {\n            flex-basis: calc(50% - 0.75rem); /* Two panels in a row */\n            min-width: 400px;\n            width: 100%;\n            max-width: calc(100% - 1.5rem);\n            box-sizing: border-box; /* Ensure padding is included in width */\n        }\n        \n        #intuitionBoxPanel {\n            flex-basis: 100%;\n            max-width: 100%;\n            min-height: 120px;\n            padding: 1rem 1.5rem; /* Reduced vertical padding */\n        }\n\n        h2 {\n            color: #00d1ff; /* Blue */\n            margin-top: 0;\n            margin-bottom: 1.2rem;\n            border-bottom: 1px solid rgba(0, 209, 255, 0.15);\n            padding-bottom: 0.5rem;\n            font-size: 1.5rem;\n        }\n\n        .stats-grid {\n            display: grid;\n            grid-template-columns: auto 1fr;\n            gap: 0.8rem 1rem;\n        }\n        .stats-label {\n            font-weight: bold;\n            color: #94a3b8; /* Grayish blue */\n        }\n        .stats-value {\n            color: #e2e8f0;\n            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;\n        }\n\n        .controls {\n            display: flex;\n            gap: 0.8rem;\n            flex-wrap: wrap;\n            justify-content: center;\n            align-items: center;\n            margin-top: 1rem;\n        }\n        .controls button {\n            background-color: #00d1ff; /* Blue */\n            color: #0f172a; /* Dark slate */\n            border: none;\n            padding: 0.7rem 1.2rem;\n            border-radius: 8px;\n            font-size: 1rem;\n            cursor: pointer;\n            transition: background-color 0.3s ease, transform 0.2s ease;\n            font-weight: bold;\n        }\n        .controls button:hover {\n            background-color: #38bdf8; /* Lighter blue */\n            transform: translateY(-2px);\n        }\n        .controls button:disabled {\n            background-color: #475569; /* Darker gray */\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        input[type=\"range\"] {\n            -webkit-appearance: none;\n            width: 100%;\n            height: 8px;\n            background: #475569; /* Gray background */\n            outline: none;\n            opacity: 0.9;\n            transition: opacity 0.2s;\n            border-radius: 4px;\n            margin-top: 1rem;\n        }\n        input[type=\"range\"]::-webkit-slider-thumb {\n            -webkit-appearance: none;\n            appearance: none;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            background: #00d1ff; /* Blue thumb */\n            cursor: grab;\n            transition: background-color 0.3s ease;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n        }\n        input[type=\"range\"]::-webkit-slider-thumb:hover {\n            background: #38bdf8; /* Lighter blue */\n        }\n\n        textarea, input[type=\"number\"] {\n            width: calc(100% - 20px);\n            padding: 10px;\n            margin-bottom: 10px;\n            border-radius: 8px;\n            border: 1px solid #475569;\n            background-color: #1e293b; /* Dark slate input */\n            color: #e2e8f0;\n            font-size: 0.95rem;\n            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;\n        }\n        textarea {\n            min-height: 80px;\n            resize: vertical;\n        }\n        label {\n            display: block;\n            margin-bottom: 5px;\n            color: #94a3b8;\n            font-weight: bold;\n        }\n\n        #generateBtn {\n            width: 100%;\n            background-color: #22c55e; /* Green */\n            color: #0f172a;\n            padding: 0.8rem;\n            border: none;\n            border-radius: 8px;\n            font-size: 1.1rem;\n            cursor: pointer;\n            transition: background-color 0.3s ease, transform 0.2s ease;\n            font-weight: bold;\n            margin-top: 0.5rem;\n        }\n        #generateBtn:hover {\n            background-color: #4ade80; /* Lighter green */\n            transform: translateY(-2px);\n        }\n\n        #intuitionBox {\n            background-color: #1e293b;\n            border: 1px solid rgba(0, 209, 255, 0.1);\n            padding: 1rem;\n            border-radius: 8px;\n            color: #a7bedc; /* Lighter gray blue */\n            white-space: pre-wrap;\n            word-wrap: break-word;\n            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;\n            font-size: 0.9rem;\n            line-height: 1.5;\n            min-height: 80px;\n            overflow-y: auto;\n            max-height: 200px;\n            margin-top: 1rem; /* Space from heading */\n        }\n        \n        .error-message {\n            color: #ef4444; /* Red */\n            margin-top: 0.5rem;\n            font-weight: bold;\n            text-align: center;\n        }\n\n        @media (max-width: 1200px) {\n            .container {\n                flex-direction: column;\n                align-items: center;\n            }\n            .panel {\n                max-width: 90%;\n                min-width: unset;\n                width: 100%;\n                flex-basis: auto;\n            }\n            #vizContainer {\n                max-width: 90%;\n                min-width: unset;\n                width: 100%;\n                height: 400px; /* Adjust height for smaller screens */\n            }\n            #statsPanel {\n                max-width: 90%;\n            }\n            #controlsPanel, #inputLab {\n                max-width: 90%;\n                width: 100%;\n            }\n            .controls {\n                justify-content: space-between;\n            }\n        }\n\n        @media (max-width: 768px) {\n            h1 {\n                font-size: 1.8rem;\n            }\n            .container {\n                padding: 1rem;\n            }\n            .panel {\n                padding: 1rem;\n                max-width: 95%;\n            }\n            #vizContainer {\n                height: 300px; /* Smaller height on mobile */\n            }\n            .controls button {\n                padding: 0.6rem 1rem;\n                font-size: 0.9rem;\n            }\n            textarea, input[type=\"number\"] {\n                font-size: 0.85rem;\n            }\n        }\n    </style>\n</head>\n<body>\n    <header>\n        <h1>Binary Search Visualization</h1>\n    </header>\n\n    <div class=\"container\">\n        <div id=\"statsPanel\" class=\"panel\">\n            <h2>Current State</h2>\n            <div class=\"stats-grid\">\n                <span class=\"stats-label\">Array:</span>\n                <span id=\"stat-array\" class=\"stats-value\"></span>\n\n                <span class=\"stats-label\">Target:</span>\n                <span id=\"stat-target\" class=\"stats-value\"></span>\n\n                <span class=\"stats-label\">Low Index:</span>\n                <span id=\"stat-low\" class=\"stats-value\"></span>\n\n                <span class=\"stats-label\">High Index:</span>\n                <span id=\"stat-high\" class=\"stats-value\"></span>\n\n                <span class=\"stats-label\">Mid Index:</span>\n                <span id=\"stat-mid\" class=\"stats-value\"></span>\n                \n                <span class=\"stats-label\">Array[Mid]:</span>\n                <span id=\"stat-array-mid\" class=\"stats-value\"></span>\n\n                <span class=\"stats-label\">Found Index:</span>\n                <span id=\"stat-found-index\" class=\"stats-value\"></span>\n\n                <span class=\"stats-label\">Status:</span>\n                <span id=\"stat-status\" class=\"stats-value\"></span>\n\n                <span class=\"stats-label\">Step:</span>\n                <span id=\"stat-step-count\" class=\"stats-value\"></span>\n            </div>\n        </div>\n\n        <div id=\"vizContainer\" class=\"panel\">\n            <h2>Dynamic Canvas</h2>\n            <canvas id=\"vizCanvas\"></canvas>\n        </div>\n\n        <div id=\"controlsPanel\" class=\"panel\">\n            <h2>Interactive Controls</h2>\n            <div class=\"controls\">\n                <button id=\"prevBtn\">Prev</button>\n                <button id=\"playPauseBtn\">Play</button>\n                <button id=\"nextBtn\">Next</button>\n                <button id=\"resetBtn\">Reset</button>\n            </div>\n            <input type=\"range\" id=\"progressSlider\" min=\"0\" value=\"0\">\n        </div>\n\n        <div id=\"inputLab\" class=\"panel\">\n            <h2>Interactive Input Lab</h2>\n            <label for=\"inputArray\">Input Array (comma-separated, sorted numbers):</label>\n            <textarea id=\"inputArray\">[2, 5, 8, 12, 16, 23, 38, 56, 72, 91]</textarea>\n\n            <label for=\"inputTarget\">Target Value:</label>\n            <input type=\"number\" id=\"inputTarget\" value=\"23\">\n            \n            <div id=\"inputError\" class=\"error-message\" style=\"display: none;\"></div>\n\n            <button id=\"generateBtn\">Generate Visualization</button>\n        </div>\n        \n        <div id=\"intuitionBoxPanel\" class=\"panel full-width\">\n            <h2>Intuition Box</h2>\n            <pre id=\"intuitionBox\">Welcome to the Binary Search Visualization! Enter your sorted array and target value, then click 'Generate Visualization' to begin.</pre>\n        </div>\n    </div>\n\n    <script>\n        const VIZ_LENS = (() => {\n            const canvas = document.getElementById('vizCanvas');\n            const ctx = canvas.getContext('2d');\n\n            // UI Elements\n            const stats = {\n                array: document.getElementById('stat-array'),\n                target: document.getElementById('stat-target'),\n                low: document.getElementById('stat-low'),\n                high: document.getElementById('stat-high'),\n                mid: document.getElementById('stat-mid'),\n                arrayMid: document.getElementById('stat-array-mid'),\n                foundIndex: document.getElementById('stat-found-index'),\n                status: document.getElementById('stat-status'),\n                stepCount: document.getElementById('stat-step-count')\n            };\n            const prevBtn = document.getElementById('prevBtn');\n            const playPauseBtn = document.getElementById('playPauseBtn');\n            const nextBtn = document.getElementById('nextBtn');\n            const resetBtn = document.getElementById('resetBtn');\n            const progressSlider = document.getElementById('progressSlider');\n            const intuitionBox = document.getElementById('intuitionBox');\n            const inputArrayElem = document.getElementById('inputArray');\n            const inputTargetElem = document.getElementById('inputTarget');\n            const generateBtn = document.getElementById('generateBtn');\n            const inputErrorElem = document.getElementById('inputError');\n\n            // Visualization State\n            let currentArray = [];\n            let targetValue = 0;\n            let steps = [];\n            let currentStepIndex = 0;\n            let animationInterval = null;\n            const animationSpeed = 1000; // ms\n\n            // --- Canvas Drawing Constants ---\n            const BAR_WIDTH_FACTOR = 0.8; // Percentage of available space for the bar\n            const BAR_MAX_HEIGHT_FACTOR = 0.6; // Max height as percentage of canvas height\n            const PADDING_X = 40;\n            const PADDING_Y = 60;\n            const VALUE_FONT_SIZE = 16;\n            const INDEX_FONT_SIZE = 14;\n\n            const COLORS = {\n                BACKGROUND: '#1e293b',\n                BAR_DEFAULT: '#38bdf8', // Light blue\n                BAR_LOW_HIGH: '#00d1ff', // Blue for pointers\n                BAR_MID: '#007bff', // Darker blue for mid\n                BAR_TARGET_FOUND: '#22c55e', // Green for found\n                BAR_SEARCH_RANGE: 'rgba(56, 189, 248, 0.2)', // Light blue transparent for range\n                TEXT_DEFAULT: '#e2e8f0', // Light text\n                TEXT_INDEX: '#94a3b8', // Grayish blue\n                ERROR: '#ef4444' // Red\n            };\n\n            // --- Helper Functions ---\n            function parseArrayInput(text) {\n                try {\n                    const cleanedText = text.replace(/[\\[\\]\\s]/g, ''); // Remove brackets and spaces\n                    const rawNumbers = cleanedText.split(',').filter(s => s.trim() !== '');\n                    const numbers = rawNumbers.map(Number);\n                    if (numbers.some(isNaN)) {\n                        throw new Error('All elements must be valid numbers.');\n                    }\n                    return numbers;\n                } catch (e) {\n                    console.error('Error parsing array:', e);\n                    return null;\n                }\n            }\n\n            function isArraySorted(arr) {\n                for (let i = 0; i < arr.length - 1; i++) {\n                    if (arr[i] > arr[i + 1]) {\n                        return false;\n                    }\n                }\n                return true;\n            }\n\n            function showInputError(message) {\n                inputErrorElem.textContent = message;\n                inputErrorElem.style.display = 'block';\n            }\n\n            function hideInputError() {\n                inputErrorElem.style.display = 'none';\n            }\n\n            function resizeCanvas() {\n                const container = canvas.parentElement;\n                canvas.width = container.clientWidth;\n                canvas.height = container.clientHeight;\n                if (steps.length > 0) {\n                    drawCanvas(steps[currentStepIndex]);\n                }\n            }\n\n            // --- Core Algorithm Simulation ---\n            function runBinarySearch(arr, target) {\n                const newSteps = [];\n                let low = 0;\n                let high = arr.length - 1;\n                let foundIndex = -1;\n                \n                const addStep = (low, high, mid, foundIndex, status, intuition) => {\n                    newSteps.push({\n                        array: [...arr], // Deep copy to ensure immutability\n                        target: target,\n                        low: low,\n                        high: high,\n                        mid: mid,\n                        foundIndex: foundIndex,\n                        status: status,\n                        intuition: intuition\n                    });\n                };\n\n                // Initial state\n                if (arr.length === 0) {\n                    addStep(-1, -1, -1, -1, \"Array is empty.\", \"There are no elements to search in an empty array.\");\n                    return newSteps;\n                }\n\n                addStep(low, high, -1, -1,\n                    \"Initial search range defined.\",\n                    `Binary search starts by defining the entire array as the search range. 'low' is the first index (${low}), 'high' is the last index (${high}).`);\n\n                while (low <= high) {\n                    const mid = Math.floor((low + high) / 2);\n                    \n                    addStep(low, high, mid, -1,\n                        \"Calculated mid-point.\",\n                        `The 'mid' index is calculated as \\`floor((low + high) / 2)\\`. For the current range [${low}, ${high}], 'mid' is ${mid}. This divides the current search range in half.`);\n\n                    if (arr[mid] === target) {\n                        foundIndex = mid;\n                        addStep(low, high, mid, foundIndex,\n                            `Target (${target}) FOUND at index ${mid}!`,\n                            `The element at 'mid' (${arr[mid]}) matches the target value (${target}). The search is successful!`);\n                        break;\n                    } else if (arr[mid] < target) {\n                        const oldLow = low;\n                        low = mid + 1;\n                        addStep(oldLow, high, mid, -1,\n                            `Comparing target (${target}) with array[mid] (${arr[mid]}). Target is GREATER.`,\n                            `Since the target (${target}) is greater than the element at 'mid' (${arr[mid]}), we eliminate the left half (including 'mid') and update 'low' to \\`mid + 1\\` (${low}) to search the right half.`);\n                    } else { // arr[mid] > target\n                        const oldHigh = high;\n                        high = mid - 1;\n                        addStep(low, oldHigh, mid, -1,\n                            `Comparing target (${target}) with array[mid] (${arr[mid]}). Target is SMALLER.`,\n                            `Since the target (${target}) is smaller than the element at 'mid' (${arr[mid]}), we eliminate the right half (including 'mid') and update 'high' to \\`mid - 1\\` (${high}) to search the left half.`);\n                    }\n                }\n\n                if (foundIndex === -1 && arr.length > 0) {\n                    addStep(low, high, -1, -1,\n                        `Target (${target}) NOT FOUND.`,\n                        `The search range 'low' (${low}) has crossed 'high' (${high}). This indicates the target value is not present in the array.`);\n                }\n\n                return newSteps;\n            }\n\n            // --- Canvas Drawing Logic ---\n            function drawCanvas(state) {\n                if (!state || !ctx) return;\n\n                const { array, target, low, high, mid, foundIndex } = state;\n                const canvasWidth = canvas.width;\n                const canvasHeight = canvas.height;\n                ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n                ctx.fillStyle = COLORS.BACKGROUND;\n                ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n                if (array.length === 0) {\n                    ctx.save();\n                    ctx.fillStyle = COLORS.TEXT_DEFAULT;\n                    ctx.font = `bold ${VALUE_FONT_SIZE * 1.5}px Arial`;\n                    ctx.textAlign = 'center';\n                    ctx.fillText(\"Array is Empty\", canvasWidth / 2, canvasHeight / 2);\n                    ctx.restore();\n                    return;\n                }\n\n                const maxValue = Math.max(...array);\n                const barCount = array.length;\n                const availableWidth = canvasWidth - 2 * PADDING_X;\n                const barTotalWidth = availableWidth / barCount;\n                const barWidth = barTotalWidth * BAR_WIDTH_FACTOR;\n                const gapWidth = barTotalWidth - barWidth;\n\n                const maxBarHeight = canvasHeight * BAR_MAX_HEIGHT_FACTOR;\n                const startX = PADDING_X + gapWidth / 2;\n                const baseY = canvasHeight - PADDING_Y;\n\n                ctx.save();\n                ctx.font = `${VALUE_FONT_SIZE}px Arial`;\n                ctx.textAlign = 'center';\n                ctx.textBaseline = 'middle';\n\n                // Draw search range highlight\n                if (low !== -1 && high !== -1 && low <= high && low < barCount && high < barCount) {\n                    const rangeStartX = startX + low * barTotalWidth - gapWidth / 2;\n                    const rangeEndX = startX + (high + 1) * barTotalWidth - gapWidth / 2;\n                    ctx.fillStyle = COLORS.BAR_SEARCH_RANGE;\n                    ctx.fillRect(rangeStartX, PADDING_Y, rangeEndX - rangeStartX, maxBarHeight + PADDING_Y / 2); // Extend slightly for visual\n                    ctx.strokeStyle = COLORS.BAR_LOW_HIGH;\n                    ctx.lineWidth = 2;\n                    ctx.strokeRect(rangeStartX, PADDING_Y, rangeEndX - rangeStartX, maxBarHeight + PADDING_Y / 2);\n                }\n\n                for (let i = 0; i < barCount; i++) {\n                    const barHeight = (array[i] / maxValue) * maxBarHeight;\n                    const x = startX + i * barTotalWidth;\n                    const y = baseY - barHeight;\n\n                    let barColor = COLORS.BAR_DEFAULT;\n                    let textColor = COLORS.TEXT_DEFAULT;\n\n                    if (foundIndex === i) {\n                        barColor = COLORS.BAR_TARGET_FOUND; // Green if found\n                    } else if (i === mid && mid !== -1) {\n                        barColor = COLORS.BAR_MID; // Darker blue for mid\n                    } else if (i === low || i === high) {\n                        barColor = COLORS.BAR_LOW_HIGH; // Blue for low/high\n                    }\n                    \n                    // Draw bar\n                    ctx.fillStyle = barColor;\n                    ctx.fillRect(x, y, barWidth, barHeight);\n\n                    // Draw value text\n                    ctx.fillStyle = textColor;\n                    ctx.font = `bold ${VALUE_FONT_SIZE}px Arial`;\n                    ctx.fillText(array[i], x + barWidth / 2, y - VALUE_FONT_SIZE / 2 - 5);\n\n                    // Draw index text\n                    ctx.fillStyle = COLORS.TEXT_INDEX;\n                    ctx.font = `${INDEX_FONT_SIZE}px Arial`;\n                    ctx.fillText(i, x + barWidth / 2, baseY + INDEX_FONT_SIZE + 5);\n                }\n                ctx.restore();\n            }\n\n            // --- UI Update Logic ---\n            function updateUI() {\n                if (steps.length === 0) {\n                    stats.array.textContent = \"N/A\";\n                    stats.target.textContent = \"N/A\";\n                    stats.low.textContent = \"N/A\";\n                    stats.high.textContent = \"N/A\";\n                    stats.mid.textContent = \"N/A\";\n                    stats.arrayMid.textContent = \"N/A\";\n                    stats.foundIndex.textContent = \"N/A\";\n                    stats.status.textContent = \"No visualization generated.\";\n                    stats.stepCount.textContent = \"0/0\";\n                    intuitionBox.textContent = \"Welcome to the Binary Search Visualization! Enter your sorted array and target value, then click 'Generate Visualization' to begin.\";\n                    drawCanvas({}); // Clear canvas or draw empty state\n                    progressSlider.max = 0;\n                    progressSlider.value = 0;\n                    prevBtn.disabled = true;\n                    nextBtn.disabled = true;\n                    playPauseBtn.disabled = true;\n                    return;\n                }\n\n                const state = steps[currentStepIndex];\n                stats.array.textContent = `[${state.array.join(', ')}]`;\n                stats.target.textContent = state.target;\n                stats.low.textContent = state.low === -1 ? 'N/A' : state.low;\n                stats.high.textContent = state.high === -1 ? 'N/A' : state.high;\n                stats.mid.textContent = state.mid === -1 ? 'N/A' : state.mid;\n                stats.arrayMid.textContent = state.mid !== -1 && state.mid < state.array.length ? state.array[state.mid] : 'N/A';\n                stats.foundIndex.textContent = state.foundIndex === -1 ? 'N/A' : state.foundIndex;\n                stats.status.textContent = state.status;\n                stats.stepCount.textContent = `${currentStepIndex + 1}/${steps.length}`;\n                intuitionBox.textContent = state.intuition;\n\n                progressSlider.max = steps.length - 1;\n                progressSlider.value = currentStepIndex;\n\n                prevBtn.disabled = currentStepIndex === 0;\n                nextBtn.disabled = currentStepIndex === steps.length - 1;\n                playPauseBtn.disabled = false;\n\n                if (currentStepIndex === steps.length - 1) {\n                    clearInterval(animationInterval);\n                    animationInterval = null;\n                    playPauseBtn.textContent = 'Play';\n                }\n\n                drawCanvas(state);\n            }\n\n            // --- Control Handlers ---\n            function nextStep() {\n                if (currentStepIndex < steps.length - 1) {\n                    currentStepIndex++;\n                    updateUI();\n                }\n            }\n\n            function prevStep() {\n                if (currentStepIndex > 0) {\n                    currentStepIndex--;\n                    updateUI();\n                }\n            }\n\n            function playPause() {\n                if (animationInterval) {\n                    clearInterval(animationInterval);\n                    animationInterval = null;\n                    playPauseBtn.textContent = 'Play';\n                } else {\n                    if (currentStepIndex === steps.length - 1) {\n                        currentStepIndex = 0; // Reset to start if at end\n                    }\n                    playPauseBtn.textContent = 'Pause';\n                    animationInterval = setInterval(() => {\n                        if (currentStepIndex < steps.length - 1) {\n                            nextStep();\n                        } else {\n                            clearInterval(animationInterval);\n                            animationInterval = null;\n                            playPauseBtn.textContent = 'Play';\n                        }\n                    }, animationSpeed);\n                }\n            }\n            \n            function resetVisualization() {\n                clearInterval(animationInterval);\n                animationInterval = null;\n                playPauseBtn.textContent = 'Play';\n                currentStepIndex = 0;\n                updateUI();\n            }\n\n            function handleSliderChange() {\n                currentStepIndex = parseInt(progressSlider.value, 10);\n                updateUI();\n                clearInterval(animationInterval); // Stop animation if slider is moved\n                animationInterval = null;\n                playPauseBtn.textContent = 'Play';\n            }\n\n            function generateVisualization() {\n                hideInputError();\n                const rawArrayText = inputArrayElem.value;\n                const parsedArray = parseArrayInput(rawArrayText);\n                const parsedTarget = Number(inputTargetElem.value);\n\n                if (!parsedArray || parsedArray.length === 0) {\n                    showInputError('Input array cannot be empty or contain non-numeric values.');\n                    steps = []; // Clear previous visualization data\n                    currentStepIndex = 0;\n                    clearInterval(animationInterval);\n                    animationInterval = null;\n                    updateUI();\n                    return;\n                }\n                if (!isArraySorted(parsedArray)) {\n                    showInputError('Input array must be sorted in ascending order.');\n                    steps = []; // Clear previous visualization data\n                    currentStepIndex = 0;\n                    clearInterval(animationInterval);\n                    animationInterval = null;\n                    updateUI();\n                    return;\n                }\n                if (isNaN(parsedTarget)) {\n                    showInputError('Target value must be a number.');\n                    steps = []; // Clear previous visualization data\n                    currentStepIndex = 0;\n                    clearInterval(animationInterval);\n                    animationInterval = null;\n                    updateUI();\n                    return;\n                }\n\n                currentArray = parsedArray;\n                targetValue = parsedTarget;\n                steps = runBinarySearch(currentArray, targetValue);\n                resetVisualization();\n            }\n\n            // --- Initialization ---\n            function init() {\n                // Event Listeners\n                prevBtn.addEventListener('click', prevStep);\n                playPauseBtn.addEventListener('click', playPause);\n                nextBtn.addEventListener('click', nextStep);\n                resetBtn.addEventListener('click', resetVisualization);\n                progressSlider.addEventListener('input', handleSliderChange);\n                generateBtn.addEventListener('click', generateVisualization);\n                window.addEventListener('resize', resizeCanvas);\n\n                // Initial setup\n                generateVisualization(); // Generate with default data on load\n                resizeCanvas(); // Set initial canvas size\n            }\n\n            // Expose public API if needed, otherwise just run init\n            return {\n                init: init\n            };\n        })();\n\n        // Initialize the VIZ-LENS engine when the DOM is ready\n        document.addEventListener('DOMContentLoaded', VIZ_LENS.init);\n    </script>\n</body>\n</html>"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "modelVersion": "gemini-2.5-flash",
  "responseId": "JURnadWNB8XnjuMPt-Kt8AQ",
  "usageMetadata": {
    "promptTokenCount": 345,
    "candidatesTokenCount": 7792,
    "totalTokenCount": 10280,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 345
      }
    ],
    "thoughtsTokenCount": 2143
  }
}

[DEBUG Response]: {
  "sdkHttpResponse": {
    "headers": {
      "alt-svc": "h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000",
      "content-encoding": "gzip",
      "content-type": "application/json; charset=UTF-8",
      "date": "Wed, 14 Jan 2026 07:22:16 GMT",
      "server": "scaffolding on HTTPServer2",
      "server-timing": "gfet4t7; dur=45997",
      "transfer-encoding": "chunked",
      "vary": "Origin, X-Origin, Referer",
      "x-content-type-options": "nosniff",
      "x-frame-options": "SAMEORIGIN",
      "x-xss-protection": "0"
    }
  },
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "<!DOCTYPE html>\n<html>\n<head>\n    <title>Binary Search Visualization - VIZ-LENS</title>\n    <style>\n        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;700&display=swap');\n\n        :root {\n            --bg-dark-slate: #0f172a;\n            --text-light: #e2e8f0;\n            --text-mono: #a7b7c7;\n            --accent-blue: #00d1ff;\n            --success-green: #22c55e;\n            --error-red: #ef4444;\n            --glass-bg: rgba(255, 255, 255, 0.08);\n            --glass-border: rgba(255, 255, 255, 0.1);\n            --glass-shadow: rgba(0, 0, 0, 0.2);\n            --canvas-bg: #1e293b;\n            --element-color: #64748b;\n            --low-high-color: var(--accent-blue);\n            --mid-color: #facc15; /* yellow-500 */\n            --found-color: var(--success-green);\n            --discarded-color: #334155;\n            --button-hover: #374151;\n            --slider-track: #334155;\n            --slider-thumb: var(--accent-blue);\n        }\n\n        body {\n            font-family: 'Inter', sans-serif;\n            margin: 0;\n            padding: 20px;\n            background-color: var(--bg-dark-slate);\n            color: var(--text-light);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            min-height: 100vh;\n            box-sizing: border-box;\n            line-height: 1.6;\n        }\n\n        .container {\n            display: grid;\n            grid-template-areas:\n                \"header header\"\n                \"canvas controls\"\n                \"inputlab inputlab\"\n                \"intuition intuition\";\n            grid-template-columns: 3fr 1fr;\n            gap: 20px;\n            width: 100%;\n            max-width: 1200px;\n        }\n\n        .panel {\n            background: var(--glass-bg);\n            border: 1px solid var(--glass-border);\n            border-radius: 12px;\n            padding: 25px;\n            backdrop-filter: blur(10px);\n            -webkit-backdrop-filter: blur(10px);\n            box-shadow: 0 4px 30px var(--glass-shadow);\n            display: flex;\n            flex-direction: column;\n        }\n\n        /* Header & Stats Panel */\n        #header-panel {\n            grid-area: header;\n            flex-direction: row;\n            justify-content: space-between;\n            align-items: center;\n            flex-wrap: wrap;\n        }\n\n        #header-panel h1 {\n            margin: 0;\n            font-size: 2.2em;\n            color: var(--accent-blue);\n        }\n\n        .stats {\n            display: flex;\n            gap: 20px;\n            flex-wrap: wrap;\n        }\n\n        .stat-item {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            padding: 8px 15px;\n            background-color: rgba(255, 255, 255, 0.05);\n            border-radius: 8px;\n            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);\n        }\n\n        .stat-label {\n            font-size: 0.8em;\n            color: var(--text-mono);\n        }\n\n        .stat-value {\n            font-size: 1.2em;\n            font-weight: bold;\n            color: var(--text-light);\n            min-width: 30px; /* Ensure consistent width */\n            text-align: center;\n        }\n\n        /* Dynamic Canvas */\n        #canvas-panel {\n            grid-area: canvas;\n            min-height: 400px;\n            background-color: var(--canvas-bg);\n            border: 1px solid var(--glass-border);\n            border-radius: 12px;\n            overflow: hidden; /* Ensure content respects border-radius */\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            position: relative;\n        }\n\n        #vizCanvas {\n            width: 100%;\n            height: 100%;\n            display: block;\n        }\n\n        /* Interactive Controls */\n        #controls-panel {\n            grid-area: controls;\n            justify-content: space-around;\n            align-items: center;\n        }\n\n        .control-group {\n            display: flex;\n            gap: 10px;\n            margin-bottom: 20px;\n            width: 100%;\n            justify-content: center;\n        }\n\n        button {\n            background-color: var(--accent-blue);\n            color: var(--bg-dark-slate);\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            font-size: 1em;\n            cursor: pointer;\n            transition: background-color 0.2s, transform 0.1s;\n            font-weight: bold;\n        }\n\n        button:hover:not(:disabled) {\n            background-color: var(--button-hover);\n            color: var(--text-light);\n            transform: translateY(-2px);\n        }\n\n        button:active:not(:disabled) {\n            transform: translateY(0);\n        }\n\n        button:disabled {\n            background-color: var(--element-color);\n            cursor: not-allowed;\n            opacity: 0.6;\n        }\n\n        #progress-slider {\n            width: 100%;\n            -webkit-appearance: none;\n            height: 8px;\n            background: var(--slider-track);\n            outline: none;\n            opacity: 0.7;\n            transition: opacity 0.2s;\n            border-radius: 5px;\n        }\n\n        #progress-slider:hover {\n            opacity: 1;\n        }\n\n        #progress-slider::-webkit-slider-thumb {\n            -webkit-appearance: none;\n            appearance: none;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            background: var(--slider-thumb);\n            cursor: grab;\n            box-shadow: 0 0 5px rgba(0,0,0,0.3);\n            transition: background-color 0.2s;\n        }\n\n        #progress-slider::-webkit-slider-thumb:active {\n            cursor: grabbing;\n        }\n\n        #progress-slider::-moz-range-thumb {\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            background: var(--slider-thumb);\n            cursor: grab;\n            box-shadow: 0 0 5px rgba(0,0,0,0.3);\n            transition: background-color 0.2s;\n        }\n\n        #progress-slider::-moz-range-thumb:active {\n            cursor: grabbing;\n        }\n\n        /* Intuition Box */\n        #intuition-box {\n            grid-area: intuition;\n            font-family: 'Roboto Mono', monospace;\n            font-size: 0.9em;\n            color: var(--text-mono);\n            min-height: 100px;\n            white-space: pre-wrap;\n            word-wrap: break-word;\n            line-height: 1.5;\n            background-color: rgba(0,0,0,0.1); /* Slightly darker for mono text */\n            border: 1px solid rgba(255,255,255,0.08);\n            border-radius: 8px;\n            padding: 15px;\n            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);\n        }\n\n        /* Interactive Input Lab */\n        #input-lab-panel {\n            grid-area: inputlab;\n            display: flex;\n            flex-direction: column;\n            gap: 15px;\n            padding-bottom: 20px;\n        }\n\n        #input-lab-panel label {\n            font-size: 1.1em;\n            color: var(--text-light);\n            margin-bottom: 5px;\n        }\n\n        #input-textarea {\n            width: 100%;\n            min-height: 80px;\n            padding: 10px;\n            border: 1px solid var(--glass-border);\n            border-radius: 8px;\n            background-color: rgba(0,0,0,0.2);\n            color: var(--text-light);\n            font-family: 'Roboto Mono', monospace;\n            font-size: 0.95em;\n            resize: vertical;\n            box-sizing: border-box;\n        }\n\n        #input-textarea:focus {\n            outline: none;\n            border-color: var(--accent-blue);\n            box-shadow: 0 0 0 2px rgba(0, 209, 255, 0.3);\n        }\n\n        #generate-btn {\n            background-color: var(--success-green);\n            color: var(--bg-dark-slate);\n        }\n\n        #generate-btn:hover:not(:disabled) {\n            background-color: #16a34a; /* green-600 */\n        }\n\n        .error-message {\n            color: var(--error-red);\n            margin-top: 10px;\n            font-weight: bold;\n        }\n\n        @media (max-width: 900px) {\n            .container {\n                grid-template-areas:\n                    \"header\"\n                    \"canvas\"\n                    \"controls\"\n                    \"inputlab\"\n                    \"intuition\";\n                grid-template-columns: 1fr;\n            }\n\n            #header-panel {\n                flex-direction: column;\n                align-items: flex-start;\n                gap: 15px;\n            }\n\n            .stats {\n                width: 100%;\n                justify-content: space-around;\n            }\n\n            .stat-item {\n                flex: 1;\n                min-width: unset;\n            }\n        }\n\n        @media (max-width: 600px) {\n            body {\n                padding: 10px;\n            }\n\n            .panel {\n                padding: 15px;\n            }\n\n            #header-panel h1 {\n                font-size: 1.8em;\n            }\n\n            .stats {\n                gap: 10px;\n            }\n\n            .stat-item {\n                padding: 5px 8px;\n            }\n\n            .control-group button {\n                padding: 8px 15px;\n                font-size: 0.9em;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header & Stats Panel -->\n        <div id=\"header-panel\" class=\"panel\">\n            <h1>Binary Search Visualization</h1>\n            <div class=\"stats\">\n                <div class=\"stat-item\">\n                    <span class=\"stat-label\">Target</span>\n                    <span id=\"stat-target\" class=\"stat-value\">?</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-label\">Low Index</span>\n                    <span id=\"stat-low\" class=\"stat-value\">?</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-label\">High Index</span>\n                    <span id=\"stat-high\" class=\"stat-value\">?</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-label\">Mid Index</span>\n                    <span id=\"stat-mid\" class=\"stat-value\">?</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-label\">Comparisons</span>\n                    <span id=\"stat-comparisons\" class=\"stat-value\">0</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-label\">Found At</span>\n                    <span id=\"stat-found-index\" class=\"stat-value\">N/A</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-label\">Step</span>\n                    <span id=\"stat-current-step\" class=\"stat-value\">0</span> / <span id=\"stat-total-steps\" class=\"stat-value\">0</span>\n                </div>\n            </div>\n        </div>\n\n        <!-- Dynamic Canvas -->\n        <div id=\"canvas-panel\" class=\"panel\">\n            <canvas id=\"vizCanvas\"></canvas>\n        </div>\n\n        <!-- Interactive Controls -->\n        <div id=\"controls-panel\" class=\"panel\">\n            <div class=\"control-group\">\n                <button id=\"prev-btn\">Prev</button>\n                <button id=\"play-pause-btn\">Play</button>\n                <button id=\"next-btn\">Next</button>\n            </div>\n            <input type=\"range\" id=\"progress-slider\" min=\"0\" max=\"0\" value=\"0\">\n        </div>\n\n        <!-- Interactive Input Lab -->\n        <div id=\"input-lab-panel\" class=\"panel\">\n            <label for=\"input-textarea\">Custom Array (comma-separated, sorted numbers) & Target:</label>\n            <textarea id=\"input-textarea\" placeholder=\"Example:\nArray: 10, 20, 30, 40, 50, 60, 70, 80\nTarget: 50\n\" spellcheck=\"false\"></textarea>\n            <button id=\"generate-btn\">Generate Visualization</button>\n            <div id=\"error-message\" class=\"error-message\" style=\"display: none;\"></div>\n        </div>\n\n        <!-- Intuition Box -->\n        <div id=\"intuition-box\" class=\"panel\">\n            <pre id=\"intuition-text\">Welcome to the Binary Search Visualization!\nEnter a sorted array of numbers and a target value above to begin.\nClick 'Generate Visualization' to see how binary search efficiently finds elements by repeatedly dividing the search interval in half.</pre>\n        </div>\n    </div>\n\n    <script>\n        // Global VIZ-LENS State Object\n        const vizState = {\n            array: [],\n            target: null,\n            steps: [], // Array of state snapshots for each step\n            currentStepIndex: 0,\n            isPlaying: false,\n            animationInterval: null,\n            animationSpeed: 700 // ms\n        };\n\n        // DOM Elements\n        const canvas = document.getElementById('vizCanvas');\n        const ctx = canvas.getContext('2d');\n        const prevBtn = document.getElementById('prev-btn');\n        const playPauseBtn = document.getElementById('play-pause-btn');\n        const nextBtn = document.getElementById('next-btn');\n        const progressSlider = document.getElementById('progress-slider');\n        const intuitionTextDiv = document.getElementById('intuition-text');\n        const inputTextArea = document.getElementById('input-textarea');\n        const generateBtn = document.getElementById('generate-btn');\n        const errorMessageDiv = document.getElementById('error-message');\n\n        // Stats elements\n        const statTarget = document.getElementById('stat-target');\n        const statLow = document.getElementById('stat-low');\n        const statHigh = document.getElementById('stat-high');\n        const statMid = document.getElementById('stat-mid');\n        const statComparisons = document.getElementById('stat-comparisons');\n        const statFoundIndex = document.getElementById('stat-found-index');\n        const statCurrentStep = document.getElementById('stat-current-step');\n        const statTotalSteps = document.getElementById('stat-total-steps');\n\n        // --- Canvas Drawing Constants & Functions ---\n        const PADDING_X = 50;\n        const PADDING_Y = 60;\n        const BAR_SPACING = 5;\n        const BAR_MAX_HEIGHT_RATIO = 0.6; // Max height as ratio of canvas height\n        const LABEL_OFFSET_Y = 25;\n        const POINTER_HEIGHT = 20;\n\n        function getBarMetrics(arrayLength) {\n            const canvasWidth = canvas.width;\n            const canvasHeight = canvas.height;\n            const availableWidth = canvasWidth - 2 * PADDING_X;\n            const barWidth = (availableWidth - (arrayLength - 1) * BAR_SPACING) / arrayLength;\n            const barMaxHeight = canvasHeight * BAR_MAX_HEIGHT_RATIO;\n            const minValue = Math.min(...vizState.array);\n            const maxValue = Math.max(...vizState.array);\n            const range = maxValue - minValue;\n            return { canvasWidth, canvasHeight, barWidth, barMaxHeight, minValue, maxValue, range };\n        }\n\n        function drawCanvas() {\n            const { array, target } = vizState;\n            const currentStepData = vizState.steps[vizState.currentStepIndex];\n\n            if (!currentStepData) {\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                return;\n            }\n\n            const { low, high, mid, foundIndex, midValue } = currentStepData;\n            const { canvasWidth, canvasHeight, barWidth, barMaxHeight, minValue, maxValue, range } = getBarMetrics(array.length);\n\n            ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n            ctx.font = \"14px 'Inter', sans-serif\";\n            ctx.textAlign = \"center\";\n            ctx.textBaseline = \"middle\";\n\n            // Draw array elements\n            for (let i = 0; i < array.length; i++) {\n                const value = array[i];\n                const barHeight = range > 0 ? (value - minValue) / range * barMaxHeight : barMaxHeight / 2;\n                const x = PADDING_X + i * (barWidth + BAR_SPACING);\n                const y = canvasHeight - PADDING_Y - barHeight;\n\n                ctx.save();\n\n                // Determine color\n                let fillColor = 'var(--element-color)';\n                let textColor = 'var(--text-light)';\n\n                if (foundIndex !== null && i === foundIndex) {\n                    fillColor = 'var(--found-color)';\n                } else if (low <= high && (i < low || i > high)) {\n                    // Element is outside the current search range\n                    fillColor = 'var(--discarded-color)';\n                    textColor = 'var(--discarded-color)';\n                } else if (i === mid && midValue !== null) {\n                    fillColor = 'var(--mid-color)';\n                    textColor = 'var(--bg-dark-slate)'; // Darker text for mid-bar\n                } else if (low <= high && i >= low && i <= high) {\n                    // Active search range\n                    fillColor = 'rgba(100, 116, 139, 0.8)'; // Slightly lighter active element\n                }\n\n                ctx.fillStyle = fillColor;\n                ctx.fillRect(x, y, barWidth, barHeight);\n                ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n                ctx.lineWidth = 1;\n                ctx.strokeRect(x, y, barWidth, barHeight);\n\n                // Draw value label\n                ctx.fillStyle = textColor;\n                ctx.fillText(value.toString(), x + barWidth / 2, y - LABEL_OFFSET_Y + 5);\n\n                // Draw index label below\n                ctx.fillStyle = 'var(--text-mono)';\n                ctx.fillText(i.toString(), x + barWidth / 2, canvasHeight - PADDING_Y + LABEL_OFFSET_Y / 2);\n\n                ctx.restore();\n            }\n\n            // Draw pointers (low, high, mid)\n            ctx.font = \"12px 'Roboto Mono', monospace\";\n            ctx.textAlign = \"center\";\n\n            if (low !== null && low <= high) { // Only draw if within bounds and valid range\n                const xLow = PADDING_X + low * (barWidth + BAR_SPACING) + barWidth / 2;\n                ctx.fillStyle = 'var(--low-high-color)';\n                ctx.beginPath();\n                ctx.moveTo(xLow, canvasHeight - PADDING_Y + LABEL_OFFSET_Y + 5);\n                ctx.lineTo(xLow - 5, canvasHeight - PADDING_Y + LABEL_OFFSET_Y - POINTER_HEIGHT + 5);\n                ctx.lineTo(xLow + 5, canvasHeight - PADDING_Y + LABEL_OFFSET_Y - POINTER_HEIGHT + 5);\n                ctx.closePath();\n                ctx.fill();\n                ctx.fillText('low', xLow, canvasHeight - PADDING_Y + LABEL_OFFSET_Y + 15);\n            }\n\n            if (high !== null && low <= high) { // Only draw if within bounds and valid range\n                const xHigh = PADDING_X + high * (barWidth + BAR_SPACING) + barWidth / 2;\n                ctx.fillStyle = 'var(--low-high-color)';\n                ctx.beginPath();\n                ctx.moveTo(xHigh, canvasHeight - PADDING_Y + LABEL_OFFSET_Y + 5);\n                ctx.lineTo(xHigh - 5, canvasHeight - PADDING_Y + LABEL_OFFSET_Y - POINTER_HEIGHT + 5);\n                ctx.lineTo(xHigh + 5, canvasHeight - PADDING_Y + LABEL_OFFSET_Y - POINTER_HEIGHT + 5);\n                ctx.closePath();\n                ctx.fill();\n                ctx.fillText('high', xHigh, canvasHeight - PADDING_Y + LABEL_OFFSET_Y + 15);\n            }\n\n            if (mid !== null && midValue !== null) { // Mid pointer draws above the array elements\n                const xMid = PADDING_X + mid * (barWidth + BAR_SPACING) + barWidth / 2;\n                const midBarY = canvasHeight - PADDING_Y - (range > 0 ? (array[mid] - minValue) / range * barMaxHeight : barMaxHeight / 2);\n                ctx.fillStyle = 'var(--mid-color)';\n                ctx.beginPath();\n                ctx.moveTo(xMid, midBarY - LABEL_OFFSET_Y - 5);\n                ctx.lineTo(xMid - 5, midBarY - LABEL_OFFSET_Y + POINTER_HEIGHT - 5);\n                ctx.lineTo(xMid + 5, midBarY - LABEL_OFFSET_Y + POINTER_HEIGHT - 5);\n                ctx.closePath();\n                ctx.fill();\n                ctx.fillStyle = 'var(--mid-color)'; // Text color for mid\n                ctx.fillText('mid', xMid, midBarY - LABEL_OFFSET_Y - 15);\n            }\n\n            // Draw target line\n            if (target !== null && target >= minValue && target <= maxValue) {\n                const targetY = canvasHeight - PADDING_Y - ((target - minValue) / range * barMaxHeight);\n                ctx.strokeStyle = 'var(--accent-blue)';\n                ctx.lineWidth = 2;\n                ctx.setLineDash([5, 5]);\n                ctx.beginPath();\n                ctx.moveTo(PADDING_X, targetY);\n                ctx.lineTo(canvasWidth - PADDING_X, targetY);\n                ctx.stroke();\n                ctx.setLineDash([]); // Reset line dash\n\n                ctx.fillStyle = 'var(--accent-blue)';\n                ctx.textAlign = 'right';\n                ctx.fillText(`Target: ${target}`, canvasWidth - PADDING_X - 10, targetY - 10);\n            }\n        }\n\n        // --- Binary Search Algorithm to generate steps ---\n        function generateBinarySearchSteps(arr, target) {\n            const steps = [];\n            let low = 0;\n            let high = arr.length - 1;\n            let foundIndex = null;\n            let comparisons = 0;\n\n            if (!arr || arr.length === 0) {\n                steps.push({\n                    array: arr, target: target, low: null, high: null, mid: null, midValue: null,\n                    foundIndex: null, comparisons: 0,\n                    intuition: \"The array is empty. Cannot perform binary search.\"\n                });\n                return steps;\n            }\n\n            // Initial state\n            steps.push({\n                array: arr, target: target, low: low, high: high, mid: null, midValue: null,\n                foundIndex: null, comparisons: comparisons,\n                intuition: `Starting binary search for ${target}. The search range is from index ${low} to ${high}.`\n            });\n\n            while (low <= high) {\n                const mid = Math.floor((low + high) / 2);\n                const midValue = arr[mid];\n                comparisons++;\n\n                if (midValue === target) {\n                    foundIndex = mid;\n                    steps.push({\n                        array: arr, target: target, low: low, high: high, mid: mid, midValue: midValue,\n                        foundIndex: foundIndex, comparisons: comparisons,\n                        intuition: `Calculated mid index as ${mid}. Value at mid is ${midValue}.\nFound ${target} at index ${mid}! Binary search completed.`\n                    });\n                    break;\n                } else if (midValue < target) {\n                    steps.push({\n                        array: arr, target: target, low: low, high: high, mid: mid, midValue: midValue,\n                        foundIndex: null, comparisons: comparisons,\n                        intuition: `Calculated mid index as ${mid}. Value at mid is ${midValue}.\n${midValue} is LESS THAN ${target}.\nThis means ${target} must be in the RIGHT HALF of the current range.\nAdjusting 'low' to 'mid + 1' (${mid + 1}).`\n                    });\n                    low = mid + 1;\n                } else { // midValue > target\n                    steps.push({\n                        array: arr, target: target, low: low, high: high, mid: mid, midValue: midValue,\n                        foundIndex: null, comparisons: comparisons,\n                        intuition: `Calculated mid index as ${mid}. Value at mid is ${midValue}.\n${midValue} is GREATER THAN ${target}.\nThis means ${target} must be in the LEFT HALF of the current range.\nAdjusting 'high' to 'mid - 1' (${mid - 1}).`\n                    });\n                    high = mid - 1;\n                }\n            }\n\n            if (foundIndex === null && (steps.length === 0 || steps[steps.length - 1].foundIndex === null)) {\n                steps.push({\n                    array: arr, target: target, low: low, high: high, mid: null, midValue: null,\n                    foundIndex: null, comparisons: comparisons,\n                    intuition: `The search range has collapsed (low > high).\n${target} is not present in the array.`\n                });\n            }\n            return steps;\n        }\n\n        // --- UI Update Functions ---\n        function updateUI() {\n            const currentStepData = vizState.steps[vizState.currentStepIndex];\n\n            // Update Stats Panel\n            if (currentStepData) {\n                statTarget.textContent = currentStepData.target !== null ? currentStepData.target : '?';\n                statLow.textContent = currentStepData.low !== null ? currentStepData.low : 'N/A';\n                statHigh.textContent = currentStepData.high !== null ? currentStepData.high : 'N/A';\n                statMid.textContent = currentStepData.mid !== null ? currentStepData.mid : 'N/A';\n                statComparisons.textContent = currentStepData.comparisons;\n                statFoundIndex.textContent = currentStepData.foundIndex !== null ? currentStepData.foundIndex : 'N/A';\n                intuitionTextDiv.textContent = currentStepData.intuition;\n            } else {\n                statTarget.textContent = '?';\n                statLow.textContent = 'N/A';\n                statHigh.textContent = 'N/A';\n                statMid.textContent = 'N/A';\n                statComparisons.textContent = '0';\n                statFoundIndex.textContent = 'N/A';\n                intuitionTextDiv.textContent = \"Please generate a visualization to begin.\";\n            }\n\n            statCurrentStep.textContent = vizState.currentStepIndex + 1;\n            statTotalSteps.textContent = vizState.steps.length;\n\n            // Update Controls\n            prevBtn.disabled = vizState.currentStepIndex === 0;\n            nextBtn.disabled = vizState.currentStepIndex === vizState.steps.length - 1;\n            playPauseBtn.textContent = vizState.isPlaying ? 'Pause' : 'Play';\n\n            progressSlider.max = vizState.steps.length > 0 ? vizState.steps.length - 1 : 0;\n            progressSlider.value = vizState.currentStepIndex;\n\n            // Redraw Canvas\n            drawCanvas();\n        }\n\n        // --- Event Handlers ---\n        function nextStep() {\n            if (vizState.currentStepIndex < vizState.steps.length - 1) {\n                vizState.currentStepIndex++;\n                updateUI();\n            } else {\n                // If at the end, pause animation\n                if (vizState.isPlaying) {\n                    togglePlayPause();\n                }\n            }\n        }\n\n        function prevStep() {\n            if (vizState.currentStepIndex > 0) {\n                vizState.currentStepIndex--;\n                updateUI();\n            }\n        }\n\n        function togglePlayPause() {\n            vizState.isPlaying = !vizState.isPlaying;\n            if (vizState.isPlaying) {\n                playPauseBtn.textContent = 'Pause';\n                vizState.animationInterval = setInterval(nextStep, vizState.animationSpeed);\n                // If at end, reset to beginning to play\n                if (vizState.currentStepIndex === vizState.steps.length - 1) {\n                    vizState.currentStepIndex = 0;\n                    updateUI();\n                }\n            } else {\n                playPauseBtn.textContent = 'Play';\n                clearInterval(vizState.animationInterval);\n            }\n            updateUI(); // To update button text immediately\n        }\n\n        function handleSliderChange() {\n            vizState.currentStepIndex = parseInt(progressSlider.value, 10);\n            updateUI();\n        }\n\n        function parseAndGenerateVisualization() {\n            errorMessageDiv.style.display = 'none';\n            const inputText = inputTextArea.value.trim();\n            const lines = inputText.split('\\n').map(line => line.trim()).filter(line => line !== '');\n\n            let parsedArray = [];\n            let parsedTarget = null;\n            let arrayFound = false;\n            let targetFound = false;\n\n            for (const line of lines) {\n                if (line.toLowerCase().startsWith('array:')) {\n                    const arrayStr = line.substring('array:'.length).trim();\n                    parsedArray = arrayStr.split(',').map(s => s.trim()).filter(s => s !== '').map(Number);\n                    arrayFound = true;\n                } else if (line.toLowerCase().startsWith('target:')) {\n                    const targetStr = line.substring('target:'.length).trim();\n                    parsedTarget = Number(targetStr);\n                    targetFound = true;\n                }\n            }\n\n            // Basic validation\n            if (!arrayFound) {\n                showError(\"Error: Array not provided. Please use 'Array: [numbers]' format.\");\n                return;\n            }\n            if (!targetFound || isNaN(parsedTarget)) {\n                showError(\"Error: Target not provided or invalid. Please use 'Target: [number]' format.\");\n                return;\n            }\n            if (parsedArray.some(isNaN)) {\n                showError(\"Error: Array contains non-numeric values. Please use comma-separated numbers.\");\n                return;\n            }\n            if (parsedArray.length === 0) {\n                 showError(\"Error: Array cannot be empty.\");\n                 return;\n            }\n\n            // Check if array is sorted\n            for (let i = 0; i < parsedArray.length - 1; i++) {\n                if (parsedArray[i] > parsedArray[i + 1]) {\n                    showError(\"Error: Array must be sorted in ascending order for Binary Search.\");\n                    return;\n                }\n            }\n\n            vizState.array = parsedArray;\n            vizState.target = parsedTarget;\n            vizState.steps = generateBinarySearchSteps(vizState.array, vizState.target);\n            vizState.currentStepIndex = 0;\n\n            if (vizState.isPlaying) {\n                togglePlayPause(); // Stop current animation\n            }\n            updateUI();\n        }\n\n        function showError(message) {\n            errorMessageDiv.textContent = message;\n            errorMessageDiv.style.display = 'block';\n        }\n\n        // --- Canvas Resizing ---\n        function resizeCanvas() {\n            const container = document.getElementById('canvas-panel');\n            canvas.width = container.clientWidth;\n            canvas.height = container.clientHeight;\n            drawCanvas(); // Redraw immediately after resize\n        }\n\n        // --- Initialization ---\n        function initialize() {\n            // Set default input\n            inputTextArea.value = `Array: 10, 20, 30, 40, 50, 60, 70, 80\nTarget: 50`;\n            parseAndGenerateVisualization(); // Generate initial viz from default input\n\n            // Event Listeners\n            prevBtn.addEventListener('click', prevStep);\n            nextBtn.addEventListener('click', nextStep);\n            playPauseBtn.addEventListener('click', togglePlayPause);\n            progressSlider.addEventListener('input', handleSliderChange);\n            generateBtn.addEventListener('click', parseAndGenerateVisualization);\n            window.addEventListener('resize', resizeCanvas);\n\n            // Initial canvas resize\n            resizeCanvas();\n        }\n\n        initialize(); // Run initialization when script loads\n    </script>\n</body>\n</html>"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "modelVersion": "gemini-2.5-flash",
  "responseId": "KERnae6zLcO64-EP-6HosQU",
  "usageMetadata": {
    "promptTokenCount": 345,
    "candidatesTokenCount": 8169,
    "totalTokenCount": 11137,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 345
      }
    ],
    "thoughtsTokenCount": 2623
  }
}
